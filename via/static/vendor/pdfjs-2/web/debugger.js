"use strict";var FontInspector=function(){let fonts,active=!1;function resetSelection(){const divs=document.querySelectorAll("span[data-font-name]");for(const div of divs)div.className="debuggerHideText"}function selectFont(fontName,show){const divs=document.querySelectorAll(`span[data-font-name=${fontName}]`);for(const div of divs)div.className=show?"debuggerShowText":"debuggerHideText"}function textLayerClick(e){if(!e.target.dataset.fontName||"SPAN"!==e.target.tagName.toUpperCase())return;const fontName=e.target.dataset.fontName,selects=document.getElementsByTagName("input");for(let i=0;i<selects.length;++i){const select=selects[i];select.dataset.fontName===fontName&&(select.checked=!select.checked,selectFont(fontName,select.checked),select.scrollIntoView())}}return{id:"FontInspector",name:"Font Inspector",panel:null,manager:null,init:function(pdfjsLib){const panel=this.panel,tmp=document.createElement("button");tmp.addEventListener("click",resetSelection),tmp.textContent="Refresh",panel.appendChild(tmp),fonts=document.createElement("div"),panel.appendChild(fonts)},cleanup:function(){fonts.textContent=""},enabled:!1,get active(){return active},set active(value){active=value,active?(document.body.addEventListener("click",textLayerClick,!0),resetSelection()):(document.body.removeEventListener("click",textLayerClick,!0),function(){const divs=document.querySelectorAll("span[data-font-name]");for(const div of divs)div.className=""}())},fontAdded:function(fontObj,url){const moreInfo=function(obj,list){const moreInfo=document.createElement("table");for(let i=0;i<list.length;i++){const tr=document.createElement("tr"),td1=document.createElement("td");td1.textContent=list[i],tr.appendChild(td1);const td2=document.createElement("td");td2.textContent=obj[list[i]].toString(),tr.appendChild(td2),moreInfo.appendChild(tr)}return moreInfo}(fontObj,["name","type"]),fontName=fontObj.loadedName,font=document.createElement("div"),name=document.createElement("span");name.textContent=fontName;const download=document.createElement("a");url?(url=/url\(['"]?([^)"']+)/.exec(url),download.href=url[1]):fontObj.data&&(download.href=URL.createObjectURL(new Blob([fontObj.data],{type:fontObj.mimeType}))),download.textContent="Download";const logIt=document.createElement("a");logIt.href="",logIt.textContent="Log",logIt.addEventListener("click",(function(event){event.preventDefault(),console.log(fontObj)}));const select=document.createElement("input");select.setAttribute("type","checkbox"),select.dataset.fontName=fontName,select.addEventListener("click",(function(){selectFont(fontName,select.checked)})),font.appendChild(select),font.appendChild(name),font.appendChild(document.createTextNode(" ")),font.appendChild(download),font.appendChild(document.createTextNode(" ")),font.appendChild(logIt),font.appendChild(moreInfo),fonts.appendChild(font),setTimeout((()=>{this.active&&resetSelection()}),2e3)}}}();let opMap;var StepperManager=function(){let steppers=[],stepperDiv=null,stepperControls=null,stepperChooser=null,breakPoints=Object.create(null);return{id:"Stepper",name:"Stepper",panel:null,manager:null,init:function(pdfjsLib){const self=this;stepperControls=document.createElement("div"),stepperChooser=document.createElement("select"),stepperChooser.addEventListener("change",(function(event){self.selectStepper(this.value)})),stepperControls.appendChild(stepperChooser),stepperDiv=document.createElement("div"),this.panel.appendChild(stepperControls),this.panel.appendChild(stepperDiv),sessionStorage.getItem("pdfjsBreakPoints")&&(breakPoints=JSON.parse(sessionStorage.getItem("pdfjsBreakPoints"))),opMap=Object.create(null);for(const key in pdfjsLib.OPS)opMap[pdfjsLib.OPS[key]]=key},cleanup:function(){stepperChooser.textContent="",stepperDiv.textContent="",steppers=[]},enabled:!1,active:!1,create:function(pageIndex){const debug=document.createElement("div");debug.id="stepper"+pageIndex,debug.hidden=!0,debug.className="stepper",stepperDiv.appendChild(debug);const b=document.createElement("option");b.textContent="Page "+(pageIndex+1),b.value=pageIndex,stepperChooser.appendChild(b);const initBreakPoints=breakPoints[pageIndex]||[],stepper=new Stepper(debug,pageIndex,initBreakPoints);return steppers.push(stepper),1===steppers.length&&this.selectStepper(pageIndex,!1),stepper},selectStepper:function(pageIndex,selectPanel){let i;for(pageIndex|=0,selectPanel&&this.manager.selectPanel(this),i=0;i<steppers.length;++i){const stepper=steppers[i];stepper.panel.hidden=stepper.pageIndex!==pageIndex}const options=stepperChooser.options;for(i=0;i<options.length;++i){const option=options[i];option.selected=(0|option.value)===pageIndex}},saveBreakPoints:function(pageIndex,bps){breakPoints[pageIndex]=bps,sessionStorage.setItem("pdfjsBreakPoints",JSON.stringify(breakPoints))}}}();const Stepper=function(){function c(tag,textContent){const d=document.createElement(tag);return textContent&&(d.textContent=textContent),d}function simplifyArgs(args){if("string"==typeof args){const MAX_STRING_LENGTH=75;return args.length<=MAX_STRING_LENGTH?args:args.substring(0,MAX_STRING_LENGTH)+"..."}if("object"!=typeof args||null===args)return args;if("length"in args){const MAX_ITEMS=10,simpleArgs=[];let i,ii;for(i=0,ii=Math.min(MAX_ITEMS,args.length);i<ii;i++)simpleArgs.push(simplifyArgs(args[i]));return i<args.length&&simpleArgs.push("..."),simpleArgs}const simpleObj={};for(const key in args)simpleObj[key]=simplifyArgs(args[key]);return simpleObj}return class{constructor(panel,pageIndex,initialBreakPoints){this.panel=panel,this.breakPoint=0,this.nextBreakPoint=null,this.pageIndex=pageIndex,this.breakPoints=initialBreakPoints,this.currentIdx=-1,this.operatorListIdx=0}init(operatorList){const panel=this.panel,content=c("div","c=continue, s=step"),table=c("table");content.appendChild(table),table.cellSpacing=0;const headerRow=c("tr");table.appendChild(headerRow),headerRow.appendChild(c("th","Break")),headerRow.appendChild(c("th","Idx")),headerRow.appendChild(c("th","fn")),headerRow.appendChild(c("th","args")),panel.appendChild(content),this.table=table,this.updateOperatorList(operatorList)}updateOperatorList(operatorList){const self=this;function cboxOnClick(){const x=+this.dataset.idx;this.checked?self.breakPoints.push(x):self.breakPoints.splice(self.breakPoints.indexOf(x),1),StepperManager.saveBreakPoints(self.pageIndex,self.breakPoints)}if(this.operatorListIdx>15e3)return;const chunk=document.createDocumentFragment(),operatorsToDisplay=Math.min(15e3,operatorList.fnArray.length);for(let i=this.operatorListIdx;i<operatorsToDisplay;i++){const line=c("tr");line.className="line",line.dataset.idx=i,chunk.appendChild(line);const checked=this.breakPoints.includes(i),args=operatorList.argsArray[i]||[],breakCell=c("td"),cbox=c("input");cbox.type="checkbox",cbox.className="points",cbox.checked=checked,cbox.dataset.idx=i,cbox.onclick=cboxOnClick,breakCell.appendChild(cbox),line.appendChild(breakCell),line.appendChild(c("td",i.toString()));const fn=opMap[operatorList.fnArray[i]];let decArgs=args;if("showText"===fn){const glyphs=args[0],charCodeRow=c("tr"),fontCharRow=c("tr"),unicodeRow=c("tr");for(let j=0;j<glyphs.length;j++){const glyph=glyphs[j];if("object"==typeof glyph&&null!==glyph)charCodeRow.appendChild(c("td",glyph.originalCharCode)),fontCharRow.appendChild(c("td",glyph.fontChar)),unicodeRow.appendChild(c("td",glyph.unicode));else{const advanceEl=c("td",glyph);advanceEl.classList.add("advance"),charCodeRow.appendChild(advanceEl),fontCharRow.appendChild(c("td")),unicodeRow.appendChild(c("td"))}}decArgs=c("td");const table=c("table");table.classList.add("showText"),decArgs.appendChild(table),table.appendChild(charCodeRow),table.appendChild(fontCharRow),table.appendChild(unicodeRow)}line.appendChild(c("td",fn)),decArgs instanceof HTMLElement?line.appendChild(decArgs):line.appendChild(c("td",JSON.stringify(simplifyArgs(decArgs))))}if(operatorsToDisplay<operatorList.fnArray.length){const lastCell=c("td","...");lastCell.colspan=4,chunk.appendChild(lastCell)}this.operatorListIdx=operatorList.fnArray.length,this.table.appendChild(chunk)}getNextBreakPoint(){this.breakPoints.sort((function(a,b){return a-b}));for(let i=0;i<this.breakPoints.length;i++)if(this.breakPoints[i]>this.currentIdx)return this.breakPoints[i];return null}breakIt(idx,callback){StepperManager.selectStepper(this.pageIndex,!0),this.currentIdx=idx;const listener=evt=>{switch(evt.keyCode){case 83:document.removeEventListener("keydown",listener),this.nextBreakPoint=this.currentIdx+1,this.goTo(-1),callback();break;case 67:document.removeEventListener("keydown",listener),this.nextBreakPoint=this.getNextBreakPoint(),this.goTo(-1),callback()}};document.addEventListener("keydown",listener),this.goTo(idx)}goTo(idx){const allRows=this.panel.getElementsByClassName("line");for(let x=0,xx=allRows.length;x<xx;++x){const row=allRows[x];(0|row.dataset.idx)===idx?(row.style.backgroundColor="rgb(251,250,207)",row.scrollIntoView()):row.style.backgroundColor=null}}}}();var Stats=function(){let stats=[];function clear(node){for(;node.hasChildNodes();)node.removeChild(node.lastChild)}return{id:"Stats",name:"Stats",panel:null,manager:null,init(pdfjsLib){},enabled:!1,active:!1,add(pageNumber,stat){if(!stat)return;const statsIndex=function(pageNumber){for(let i=0,ii=stats.length;i<ii;++i)if(stats[i].pageNumber===pageNumber)return i;return!1}(pageNumber);if(!1!==statsIndex){const b=stats[statsIndex];this.panel.removeChild(b.div),stats.splice(statsIndex,1)}const wrapper=document.createElement("div");wrapper.className="stats";const title=document.createElement("div");title.className="title",title.textContent="Page: "+pageNumber;const statsDiv=document.createElement("div");statsDiv.textContent=stat.toString(),wrapper.appendChild(title),wrapper.appendChild(statsDiv),stats.push({pageNumber:pageNumber,div:wrapper}),stats.sort((function(a,b){return a.pageNumber-b.pageNumber})),clear(this.panel);for(let i=0,ii=stats.length;i<ii;++i)this.panel.appendChild(stats[i].div)},cleanup(){stats=[],clear(this.panel)}}}();window.PDFBug=function(){const buttons=[];let activePanel=null;return{tools:[FontInspector,StepperManager,Stats],enable(ids){const all=1===ids.length&&"all"===ids[0],tools=this.tools;for(let i=0;i<tools.length;++i){const tool=tools[i];(all||ids.includes(tool.id))&&(tool.enabled=!0)}all||tools.sort((function(a,b){let indexA=ids.indexOf(a.id);indexA=indexA<0?tools.length:indexA;let indexB=ids.indexOf(b.id);return indexB=indexB<0?tools.length:indexB,indexA-indexB}))},init(pdfjsLib,container,ids){this.enable(ids);const ui=document.createElement("div");ui.id="PDFBug";const controls=document.createElement("div");controls.setAttribute("class","controls"),ui.appendChild(controls);const panels=document.createElement("div");panels.setAttribute("class","panels"),ui.appendChild(panels),container.appendChild(ui),container.style.right="300px";const tools=this.tools,self=this;for(let i=0;i<tools.length;++i){const tool=tools[i],panel=document.createElement("div"),panelButton=document.createElement("button");panelButton.textContent=tool.name,panelButton.addEventListener("click",function(selected){return function(event){event.preventDefault(),self.selectPanel(selected)}}(i)),controls.appendChild(panelButton),panels.appendChild(panel),tool.panel=panel,tool.manager=this,tool.enabled?tool.init(pdfjsLib):panel.textContent=`${tool.name} is disabled. To enable add "${tool.id}" to the pdfBug parameter and refresh (separate multiple by commas).`,buttons.push(panelButton)}this.selectPanel(0)},cleanup(){for(let i=0,ii=this.tools.length;i<ii;i++)this.tools[i].enabled&&this.tools[i].cleanup()},selectPanel(index){if("number"!=typeof index&&(index=this.tools.indexOf(index)),index===activePanel)return;activePanel=index;const tools=this.tools;for(let j=0;j<tools.length;++j){const isActive=j===index;buttons[j].classList.toggle("active",isActive),tools[j].active=isActive,tools[j].panel.hidden=!isActive}}}}();
